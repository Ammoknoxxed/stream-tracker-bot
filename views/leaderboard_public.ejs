<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranking | <%= guild.name %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/style.css">
    <style>
        .leaderboard-container { max-width: 900px; margin: 40px auto; }
        .top-three { display: flex; justify-content: center; align-items: flex-end; gap: 20px; margin-bottom: 50px; padding-top: 20px; }
        
        /* Podium-Plätze */
        .podium-card { 
            background: var(--bg-card); backdrop-filter: blur(10px); 
            border: 1px solid rgba(255,255,255,0.1); border-radius: 20px;
            padding: 20px; text-align: center; position: relative; transition: 0.3s;
        }
        .podium-card:hover { transform: translateY(-10px); border-color: var(--accent); }
        .podium-1 { order: 2; width: 220px; height: 280px; border: 2px solid #fbbf24; box-shadow: 0 0 30px rgba(251, 191, 36, 0.2); }
        .podium-2 { order: 1; width: 180px; height: 230px; }
        .podium-3 { order: 3; width: 180px; height: 230px; }

        .podium-avatar { width: 80px; height: 80px; border-radius: 50%; border: 3px solid #fff; margin-bottom: 10px; }
        .podium-1 .podium-avatar { width: 100px; height: 100px; border-color: #fbbf24; }
        
        .crown-icon { position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-size: 2rem; }
    </style>
</head>
<body>

<div class="container leaderboard-container">
    <div class="text-center mb-5">
        <h1 class="display-5 fw-bold text-accent">STREAM RANKING</h1>
        <p class="opacity-50 text-uppercase letter-spacing-2"><%= guild.name %></p>
    </div>

    <% if(trackedUsers.length >= 1) { %>
    <div class="top-three">
        <% trackedUsers.slice(0, 3).forEach((user, index) => { %>
            <div class="podium-card podium-<%= index + 1 %> glass-card">
                <% if(index === 0) { %><i class="fas fa-crown crown-icon rank-gold"></i><% } %>
                <img src="<%= user.avatar || 'https://cdn.discordapp.com/embed/avatars/0.png' %>" class="podium-avatar <%= user.isStreaming ? 'border-danger' : '' %>">
                <h4 class="mb-1 text-truncate"><%= user.username %></h4>
                <div class="text-accent fw-bold"><%= user.totalMinutes %> Min</div>
                <div class="small opacity-50">Platz <%= index + 1 %></div>
            </div>
        <% }) %>
    </div>
    <% } %>

    <div class="glass-card overflow-hidden">
        <table class="table table-hover align-middle mb-0">
            <thead class="bg-dark bg-opacity-50">
                <tr>
                    <th class="ps-4 py-3">#</th>
                    <th>User</th>
                    <th class="text-end pe-4">Gesamtzeit</th>
                </tr>
            </thead>
            <tbody>
                <% trackedUsers.slice(3).forEach((user, index) => { %>
                <tr class="border-bottom border-secondary border-opacity-10">
                    <td class="ps-4 opacity-50">#<%= index + 4 %></td>
                    <td class="d-flex align-items-center">
                        <img src="<%= user.avatar || 'https://cdn.discordapp.com/embed/avatars/0.png' %>" 
                             style="width: 35px; height: 35px; border-radius: 50%;" 
                             class="me-3 border <%= user.isStreaming ? 'border-danger' : 'border-secondary' %>">
                        <span class="fw-bold"><%= user.username %></span>
                        <% if(user.isStreaming) { %>
                            <span class="ms-2 badge bg-danger" style="font-size: 0.6rem; animation: pulse 2s infinite;">LIVE</span>
                        <% } %>
                    </td>
                    <td class="text-end pe-4">
                        <span class="text-accent fw-bold"><%= user.totalMinutes %></span> <span class="small opacity-50">Min</span>
                    </td>
                </tr>
                <% }) %>

                <% if(trackedUsers.length === 0) { %>
                    <tr><td colspan="3" class="text-center py-5 opacity-50">Noch keine Daten verfügbar. Startet den ersten Stream!</td></tr>
                <% } %>
            </tbody>
        </table>
    </div>

    <div class="text-center mt-5 opacity-25 small">
        <p>Daten werden bei Stream-Ende aktualisiert</p>
    </div>
</div>

</body>
</html>
