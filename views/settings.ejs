<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Einstellungen - <%= guild.name %></title>
    <style>
        body { font-family: sans-serif; background: #23272a; color: white; padding: 20px; }
        .section { background: #2c2f33; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #444; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; border-bottom: 1px solid #444; text-align: left; }
        th { background: #23272a; }
        input, select { padding: 8px; border-radius: 4px; border: none; margin-right: 10px; }
        .btn-save { background: #43b581; color: white; border: none; cursor: pointer; padding: 8px 15px; border-radius: 4px; }
        .btn-del { background: #f04747; color: white; border: none; cursor: pointer; padding: 5px 10px; border-radius: 4px; }
        .back-link { color: #7289da; text-decoration: none; display: block; margin-bottom: 20px; }
    </style>
</head>
<body>
    <a href="/dashboard" class="back-link">← Zurück zur Übersicht</a>
    <h1>Server: <%= guild.name %></h1>

    <div class="section">
        <h2>Rollen-Belohnungen</h2>
        <form action="/dashboard/<%= guild.id %>/save" method="POST">
            <input type="number" name="minutes" placeholder="Minuten (z.B. 120)" required min="1">
            <select name="roleId" required>
                <option value="" disabled selected>Rolle auswählen...</option>
                <% roles.forEach(role => { %>
                    <option value="<%= role.id %>"><%= role.name %></option>
                <% }) %>
            </select>
            <button type="submit" class="btn-save">Hinzufügen</button>
        </form>

        <table>
            <thead>
                <tr>
                    <th>Minuten benötigt</th>
                    <th>Rolle</th>
                    <th>Aktion</th>
                </tr>
            </thead>
            <tbody>
                <% config.rewards.forEach((reward, index) => { %>
                    <tr>
                        <td><%= reward.minutesRequired %> Min.</td>
                        <td>@<%= reward.roleName %></td>
                        <td>
                            <form action="/dashboard/<%= guild.id %>/delete-reward" method="POST">
                                <input type="hidden" name="rewardIndex" value="<%= index %>">
                                <button type="submit" class="btn-del">Löschen</button>
                            </form>
                        </td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    </div>

    <div class="section">
        <h2>Getrackte User (Statistik)</h2>
        <table>
            <thead>
                <tr>
                    <th>User</th>
                    <th>Gesamtzeit</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <% trackedUsers.forEach(user => { %>
                    <tr>
                        <td><%= user.username %></td>
                        <td><%= user.totalMinutes %> Minuten</td>
                        <td>
                            <% if(user.isStreaming) { %>
                                <span style="color: #43b581;">● Streamt gerade</span>
                            <% } else { %>
                                <span style="color: #72767d;">Offline / Kein Stream</span>
                            <% } %>
                        </td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    </div>
</body>
</html>