<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Einstellungen - <%= guild.name %></title>
    <style>
        body { font-family: sans-serif; background: #23272a; color: white; padding: 20px; }
        .section { background: #2c2f33; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #444; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; border-bottom: 1px solid #444; text-align: left; }
        th { background: #23272a; }
        input, select { padding: 8px; border-radius: 4px; border: none; margin-right: 10px; }
        .btn-save { background: #43b581; color: white; border: none; cursor: pointer; padding: 8px 15px; border-radius: 4px; }
        .btn-del { background: #f04747; color: white; border: none; cursor: pointer; padding: 5px 10px; border-radius: 4px; }
        .back-link { color: #7289da; text-decoration: none; display: block; margin-bottom: 20px; }
    </style>
</head>
<body>
    <a href="/dashboard" class="back-link">‚Üê Zur√ºck zur √úbersicht</a>
    <h1>Server: <%= guild.name %></h1>

    <div class="section">
        <h2>Rollen-Belohnungen</h2>
        <form action="/dashboard/<%= guild.id %>/save" method="POST">
            <input type="number" name="minutes" placeholder="Minuten (z.B. 120)" required min="1">
            <select name="roleId" required>
                <option value="" disabled selected>Rolle ausw√§hlen...</option>
                <% roles.forEach(role => { %>
                    <option value="<%= role.id %>"><%= role.name %></option>
                <% }) %>
            </select>
            <button type="submit" class="btn-save">Hinzuf√ºgen</button>
        </form>

        <table>
            <thead>
                <tr>
                    <th>Minuten ben√∂tigt</th>
                    <th>Rolle</th>
                    <th>Aktion</th>
                </tr>
            </thead>
            <tbody>
                <% config.rewards.forEach((reward, index) => { %>
                    <tr>
                        <td><%= reward.minutesRequired %> Min.</td>
                        <td>@<%= reward.roleName %></td>
                        <td>
                            <form action="/dashboard/<%= guild.id %>/delete-reward" method="POST">
                                <input type="hidden" name="rewardIndex" value="<%= index %>">
                                <button type="submit" class="btn-del">L√∂schen</button>
                            </form>
                        </td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    </div>

<div class="card mt-4">
    <div class="card-header">Erlaubte Channels / Kategorien</div>
    <div class="card-body">
        <p class="text-muted small">W√§hle aus, in welchen Channels oder Kategorien das Tracking aktiv sein soll. Ist nichts ausgew√§hlt, wird √ºberall getrackt.</p>
        <form action="/dashboard/<%= guild.id %>/save-channels" method="POST">
            <div class="row">
                <% channels.forEach(channel => { %>
                    <div class="col-md-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="channels" value="<%= channel.id %>" id="ch-<%= channel.id %>" 
                            <%= config.allowedChannels && config.allowedChannels.includes(channel.id) ? 'checked' : '' %>>
                            <label class="form-check-label" for="ch-<%= channel.id %>">
                                <%= channel.type === 4 ? 'üìÅ ' : 'üîä ' %> <%= channel.name %>
                            </label>
                        </div>
                    </div>
                <% }) %>
            </div>
            <button type="submit" class="btn btn-primary mt-3">Kan√§le speichern</button>
        </form>
    </div>
</div>

    <div class="section">
        <h2>Getrackte User (Statistik)</h2>
        <table>
            <thead>
                <tr>
                    <th>User</th>
                    <th>Gesamtzeit</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <% trackedUsers.forEach(user => { %>
                    <tr>
                        <td><%= user.username %></td>
                        <td><%= user.totalMinutes %> Minuten</td>
                        <td>
                            <% if(user.isStreaming) { %>
                                <span style="color: #43b581;">‚óè Streamt gerade</span>
                            <% } else { %>
                                <span style="color: #72767d;">Offline / Kein Stream</span>
                            <% } %>
                        </td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    </div>
</body>

</html>
